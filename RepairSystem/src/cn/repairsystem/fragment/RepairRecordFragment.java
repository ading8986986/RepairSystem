package cn.repairsystem.fragment;import java.util.ArrayList;import java.util.List;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import cn.repairsystem.R;import cn.repairsystem.activity.RepairDetailActivity;import cn.repairsystem.adapter.RepairedProjectListAdapter;import cn.repairsystem.bean.CurrentRepairItem;import cn.repairsystem.network.HttpController;import cn.repairsystem.network.HttpController.HttpResultListener;import cn.repairsystem.util.UtilToast;import android.content.Intent;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.LinearLayout;import android.widget.AdapterView.OnItemClickListener;import android.widget.ListView;public class RepairRecordFragment extends Fragment implements OnItemClickListener,HttpResultListener{		private View mView;	private ListView listView;		private RepairedProjectListAdapter mAdapter;	private List<CurrentRepairItem> dataList;	private HttpController mController;	private int pageindex;	private LinearLayout waitingLayout;		@Override	public View onCreateView(LayoutInflater inflater,			@Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {		// TODO Auto-generated method stub		mView = View.inflate(getActivity(), R.layout.record_fragment, null);		initView();		initData();		return mView;	}		private void initView(){		listView = (ListView) mView.findViewById(R.id.content);		waitingLayout = (LinearLayout) mView.findViewById(R.id.ll_waiting_layout);		listView.setOnItemClickListener(this);	}		private void initData(){		if (mController == null) { 			mController = HttpController.getInstance(getActivity());		}		mAdapter = new RepairedProjectListAdapter(getActivity());		listView.setAdapter(mAdapter);		pageindex = 1;		//getRepairedProjectData();			}	@Override	public void onItemClick(AdapterView<?> parent, View view, int position,			long id) {		// TODO Auto-generated method stub		Intent intent = new Intent(getActivity(),RepairDetailActivity.class);		intent.putExtra("repaireId", dataList.get(position).getId());		startActivity(intent);			}		/**	 * 同步报修项目	 * **/	public void getRepairedProjectData(){		waitingLayout.setVisibility(View.VISIBLE);		JSONObject param = new JSONObject();		try {			param.put("pageindex", pageindex);		} catch (JSONException e) {			// TODO Auto-generated catch block			e.printStackTrace();		}		mController.getRepairedProject(this, param);	}	@Override	public void onResult(boolean isSuccess, JSONObject object) {		// TODO Auto-generated method stub		waitingLayout.setVisibility(View.GONE);		try {			if(isSuccess &&object.get("bxlist") != null){				JSONObject dataObject = object.getJSONObject("bxlist");				if(dataList == null ) 					dataList = new ArrayList<CurrentRepairItem>();				else dataList.clear();				for (int i = 0; i < dataObject.getJSONArray("result").length(); i++) {										try {						dataList.add(new CurrentRepairItem((JSONArray) dataObject.getJSONArray("result").get(i)));					} catch (JSONException e) {						// TODO Auto-generated catch block						e.printStackTrace();					}				}				mAdapter.setList(dataList);			}			else UtilToast.showShort(getActivity(), "获取数据失败");		}		catch (JSONException e) {			// TODO Auto-generated catch block			e.printStackTrace();		}	}}